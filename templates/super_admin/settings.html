{% extends "content_base.html" %}

{% block title %}System Settings - Super Admin{% endblock %}

{% block page_title %}System Settings{% endblock %}

{% block page_description %}Configure system-wide settings and preferences{% endblock %}

{% block sidebar_menu %}
<li>
    <a href="{{ url_for('super_admin.dashboard') }}">
        <i class="fas fa-tachometer-alt"></i> Dashboard
    </a>
</li>
<li>
    <a href="{{ url_for('super_admin.schools') }}">
        <i class="fas fa-school"></i> Schools
    </a>
</li>
<li>
    <a href="{{ url_for('super_admin.users') }}">
        <i class="fas fa-users"></i> Users
    </a>
</li>
<li class="active">
    <a href="{{ url_for('super_admin.settings') }}">
        <i class="fas fa-cog"></i> Settings
    </a>
</li>
<li>
    <a href="{{ url_for('super_admin.reports') }}">
        <i class="fas fa-chart-line"></i> Reports
    </a>
</li>
<li>
    <a href="{{ url_for('super_admin.activity_logs') }}">
        <i class="fas fa-history"></i> Activity Logs
    </a>
</li>
<li>
    <a href="{{ url_for('auth.logout') }}">
        <i class="fas fa-sign-out-alt"></i> Logout
    </a>
</li>
{% endblock %}

{% block header_actions %}
{{ super() }}
<div style="display: flex; gap: var(--spacing-sm);">
    <button class="btn btn-outline btn-sm" onclick="resetSettings()">
        <i class="fas fa-undo"></i> Reset
    </button>
    <button class="btn btn-primary btn-sm" onclick="saveSettings()">
        <i class="fas fa-save"></i> Save Changes
    </button>
</div>
{% endblock %}

{% block content %}
<div class="tactical-container">
    <!-- System Overview -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
        <div class="tactical-card text-center">
            <div style="color: var(--color-primary); font-size: 2.5rem; margin-bottom: var(--spacing-sm);">
                <i class="fas fa-users"></i>
            </div>
            <h3 style="margin: 0; font-size: 2rem; color: var(--color-primary);">{{ stats.total_users }}</h3>
            <p style="margin: var(--spacing-xs) 0 0 0; color: var(--color-muted);">Total Users</p>
        </div>
        
        <div class="tactical-card text-center">
            <div style="color: var(--color-success); font-size: 2.5rem; margin-bottom: var(--spacing-sm);">
                <i class="fas fa-school"></i>
            </div>
            <h3 style="margin: 0; font-size: 2rem; color: var(--color-success);">{{ stats.total_schools }}</h3>
            <p style="margin: var(--spacing-xs) 0 0 0; color: var(--color-muted);">Total Schools</p>
        </div>
        
        <div class="tactical-card text-center">
            <div style="color: var(--color-warning); font-size: 2.5rem; margin-bottom: var(--spacing-sm);">
                <i class="fas fa-user-graduate"></i>
            </div>
            <h3 style="margin: 0; font-size: 2rem; color: var(--color-warning);">{{ stats.total_students }}</h3>
            <p style="margin: var(--spacing-xs) 0 0 0; color: var(--color-muted);">Total Students</p>
        </div>
        
        <div class="tactical-card text-center">
            <div style="color: var(--color-info); font-size: 2.5rem; margin-bottom: var(--spacing-sm);">
                <i class="fas fa-database"></i>
            </div>
            <h3 style="margin: 0; font-size: 2rem; color: var(--color-info);">{{ stats.database_size }}</h3>
            <p style="margin: var(--spacing-xs) 0 0 0; color: var(--color-muted);">Database Size</p>
        </div>
    </div>

    <!-- Settings Navigation -->
    <div class="tactical-card" style="margin-bottom: var(--spacing-lg);">
        <div style="display: flex; gap: var(--spacing-md); border-bottom: 1px solid var(--color-border); padding-bottom: var(--spacing-md);">
            <button class="btn btn-outline btn-sm active" onclick="showSettingsTab('system')">
                <i class="fas fa-server"></i> System
            </button>
            <button class="btn btn-outline btn-sm" onclick="showSettingsTab('security')">
                <i class="fas fa-shield-alt"></i> Security
            </button>
            <button class="btn btn-outline btn-sm" onclick="showSettingsTab('notifications')">
                <i class="fas fa-bell"></i> Notifications
            </button>
            <button class="btn btn-outline btn-sm" onclick="showSettingsTab('backup')">
                <i class="fas fa-database"></i> Backup
            </button>
            <button class="btn btn-outline btn-sm" onclick="showSettingsTab('maintenance')">
                <i class="fas fa-tools"></i> Maintenance
            </button>
        </div>
    </div>

    <!-- System Settings -->
    <div id="system-settings" class="settings-tab">
        <div class="tactical-card">
            <h3 style="margin-bottom: var(--spacing-lg);">
                <i class="fas fa-server"></i> System Configuration
            </h3>
            
            <form class="form-grid">
                <div class="form-group">
                    <label class="form-label">System Name</label>
                    <input type="text" class="form-input" value="School Management System" placeholder="Enter system name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">System Version</label>
                    <input type="text" class="form-input" value="v2.1.7" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Default Subscription Period (months)</label>
                    <input type="number" class="form-input" value="12" min="1" max="60">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Max Schools per System</label>
                    <input type="number" class="form-input" value="1000" min="1">
                </div>
                
                <div class="form-group">
                    <label class="form-label">System Timezone</label>
                    <select class="form-select">
                        <option value="UTC" selected>UTC</option>
                        <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
                        <option value="America/New_York">America/New_York (EST)</option>
                        <option value="Europe/London">Europe/London (GMT)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">System Status</label>
                    <select class="form-select">
                        <option value="operational" selected>Operational</option>
                        <option value="maintenance">Maintenance Mode</option>
                        <option value="limited">Limited Access</option>
                    </select>
                </div>
            </form>
        </div>
    </div>

    <!-- Security Settings -->
    <div id="security-settings" class="settings-tab" style="display: none;">
        <div class="tactical-card">
            <h3 style="margin-bottom: var(--spacing-lg);">
                <i class="fas fa-shield-alt"></i> Security Configuration
            </h3>
            
            <form class="form-grid">
                <div class="form-group">
                    <label class="form-label">Password Policy</label>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-xs);">
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Minimum 8 characters
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Require uppercase letters
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Require numbers
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox"> Require special characters
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Session Timeout (minutes)</label>
                    <input type="number" class="form-input" value="60" min="5" max="480">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Max Login Attempts</label>
                    <input type="number" class="form-input" value="5" min="3" max="10">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Account Lockout Duration (minutes)</label>
                    <input type="number" class="form-input" value="30" min="5" max="1440">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Two-Factor Authentication</label>
                    <label class="checkbox-label">
                        <input type="checkbox"> Require 2FA for super admins
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="form-label">API Rate Limiting</label>
                    <input type="number" class="form-input" value="1000" placeholder="Requests per hour">
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Settings -->
    <div id="notifications-settings" class="settings-tab" style="display: none;">
        <div class="tactical-card">
            <h3 style="margin-bottom: var(--spacing-lg);">
                <i class="fas fa-bell"></i> Notification Configuration
            </h3>
            
            <form class="form-grid">
                <div class="form-group">
                    <label class="form-label">Email Notifications</label>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-xs);">
                        <label class="checkbox-label">
                            <input type="checkbox" checked> System alerts
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" checked> New school registrations
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" checked> Subscription expiries
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox"> Daily reports
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">SMS Notifications</label>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-xs);">
                        <label class="checkbox-label">
                            <input type="checkbox"> Critical system alerts
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox"> Security incidents
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">SMTP Server</label>
                    <input type="text" class="form-input" placeholder="smtp.example.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">SMTP Port</label>
                    <input type="number" class="form-input" value="587">
                </div>
                
                <div class="form-group">
                    <label class="form-label">From Email</label>
                    <input type="email" class="form-input" placeholder="noreply@example.com">
                </div>
            </form>
        </div>
    </div>

    <!-- Backup Settings -->
    <div id="backup-settings" class="settings-tab" style="display: none;">
        <div class="tactical-card">
            <h3 style="margin-bottom: var(--spacing-lg);">
                <i class="fas fa-database"></i> Backup Configuration
            </h3>
            
            <form class="form-grid">
                <div class="form-group">
                    <label class="form-label">Automatic Backups</label>
                    <select class="form-select">
                        <option value="daily" selected>Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="disabled">Disabled</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Backup Time</label>
                    <input type="time" class="form-input" value="02:00">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Retention Period (days)</label>
                    <input type="number" class="form-input" value="30" min="1" max="365">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Backup Location</label>
                    <select class="form-select">
                        <option value="local" selected>Local Storage</option>
                        <option value="s3">Amazon S3</option>
                        <option value="gcs">Google Cloud Storage</option>
                        <option value="azure">Azure Blob Storage</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Last Backup</label>
                    <input type="text" class="form-input" value="2024-01-15 02:00:00" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Backup Status</label>
                    <span class="badge badge-success">Healthy</span>
                </div>
            </form>
            
            <div style="margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--color-border);">
                <button class="btn btn-primary" onclick="createBackup()">
                    <i class="fas fa-database"></i> Create Backup Now
                </button>
                <button class="btn btn-outline" onclick="restoreBackup()">
                    <i class="fas fa-upload"></i> Restore from Backup
                </button>
            </div>
        </div>
    </div>

    <!-- Maintenance Settings -->
    <div id="maintenance-settings" class="settings-tab" style="display: none;">
        <div class="tactical-card">
            <h3 style="margin-bottom: var(--spacing-lg);">
                <i class="fas fa-tools"></i> System Maintenance
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--spacing-lg);">
                <div>
                    <h4>System Status</h4>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>System Uptime</span>
                            <span class="badge badge-success">{{ stats.uptime }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Database Status</span>
                            <span class="badge badge-success">Online</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Cache Status</span>
                            <span class="badge badge-success">Active</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Storage Usage</span>
                            <span class="badge badge-warning">{{ stats.database_size }}</span>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4>Maintenance Actions</h4>
                    <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                        <button class="btn btn-outline" onclick="clearCache()">
                            <i class="fas fa-broom"></i> Clear System Cache
                        </button>
                        <button class="btn btn-outline" onclick="optimizeDatabase()">
                            <i class="fas fa-database"></i> Optimize Database
                        </button>
                        <button class="btn btn-outline" onclick="cleanupLogs()">
                            <i class="fas fa-trash"></i> Cleanup Old Logs
                        </button>
                        <button class="btn btn-warning" onclick="enableMaintenanceMode()">
                            <i class="fas fa-tools"></i> Enable Maintenance Mode
                        </button>
                        <button class="btn btn-error" onclick="restartSystem()">
                            <i class="fas fa-power-off"></i> Restart System
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showSettingsTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.style.display = 'none';
    });
    
    // Remove active class from all buttons
    document.querySelectorAll('.btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(tabName + '-settings').style.display = 'block';
    
    // Add active class to clicked button
    event.target.classList.add('active');
}

function saveSettings() {
    alert('Settings save functionality will be implemented soon.');
}

function resetSettings() {
    if (confirm('Are you sure you want to reset all settings to default values?')) {
        alert('Settings reset functionality will be implemented soon.');
    }
}

function createBackup() {
    alert('Creating backup... This may take a few minutes.');
}

function restoreBackup() {
    alert('Restore backup functionality will be implemented soon.');
}

function clearCache() {
    if (confirm('Are you sure you want to clear the system cache?')) {
        alert('Cache cleared successfully.');
    }
}

function optimizeDatabase() {
    if (confirm('Are you sure you want to optimize the database?')) {
        alert('Database optimization started...');
    }
}

function cleanupLogs() {
    if (confirm('Are you sure you want to cleanup old logs?')) {
        alert('Log cleanup completed.');
    }
}

function enableMaintenanceMode() {
    if (confirm('Are you sure you want to enable maintenance mode? This will prevent users from accessing the system.')) {
        alert('Maintenance mode functionality will be implemented soon.');
    }
}

function restartSystem() {
    if (confirm('Are you sure you want to restart the system? This will temporarily interrupt service.')) {
        alert('System restart functionality will be implemented soon.');
    }
}
</script>

<style>
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--spacing-lg);
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
    margin: 0;
}
</style>
{% endblock %}